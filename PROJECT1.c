#include <stdlib.h>
#include <stdio.h>
#include <math.h>
#include <conio.h>
#include <time.h>
#include <unistd.h>
#include <string.h>

void IntroSecuence(){
    system("cls");

    for (int frame = 0; 40> frame; frame++){

        system("cls");
        if (frame == 2){
            printf("                           \n");
            printf("                           \n");
            printf("             |             \n");
            printf("             |             \n");
            printf("             |             \n");
            printf("             |             \n");
            printf("             |             \n");
            printf("                           \n");
        }
        if (frame == 3){
            printf("                           \n");
            printf("            ___            \n");
            printf("           |   |           \n");
            printf("           |   |           \n");
            printf("           |  .|           \n");
            printf("           |   |           \n");
            printf("           |___|           \n");
            printf("                           \n");
        }
        if (frame == 4){
            printf("                           \n");
            printf("           _____           \n");
            printf("          |     |          \n");
            printf("          |     |          \n");
            printf("          |  - .|          \n");
            printf("          |     |          \n");
            printf("          |_____|          \n");
            printf("                           \n");
        }
        if (frame == 5){
            printf("                           \n");
            printf("            ___            \n");
            printf("           |   |           \n");
            printf("           |   |           \n");
            printf("           |  .|           \n");
            printf("           |   |           \n");
            printf("           |___|           \n");
            printf("                           \n");
        }
        if (frame == 6){
            printf("                           \n");
            printf("                           \n");
            printf("             |             \n");
            printf("             |             \n");
            printf("             |             \n");
            printf("             |             \n");
            printf("             |             \n");
            printf("                           \n");
        }
        if (frame == 7){
            printf("                           \n");
            printf("            ___            \n");
            printf("           |   |           \n");
            printf("           |   |           \n");
            printf("           |   |           \n");
            printf("           |   |           \n");
            printf("           |___|           \n");
            printf("                           \n");
        }
        if (frame == 8){
            printf("                           \n");
            printf("           _____           \n");
            printf("          |     |          \n");
            printf("          |     |          \n");
            printf("          |     |          \n");
            printf("          |     |          \n");
            printf("          |_____|          \n");
            printf("                           \n");
        }
        if (frame == 9){
            printf("         _________         \n");
            printf("        |         |        \n");
            printf("        |         |        \n");
            printf("        |         |        \n");
            printf("        |         |        \n");
            printf("        |         |        \n");
            printf("        |         |        \n");
            printf("        |_________|        \n");
            printf("                           \n");
        }
        if (frame == 10){
            printf("         _________    |/   \n");
            printf("        |   T     |        \n");
            printf("        |         |        \n");
            printf("        |         |        \n");
            printf("        |        S|        \n");
            printf("        |         |        \n");
            printf("        |         |        \n");
            printf("        |_________|        \n");
            printf("   /|                      \n");
        }
        if (frame == 11){
            printf("         _________    ||   \n");
            printf("        |   THE   |   |/   \n");
            printf("        |         |        \n");
            printf("        |         |        \n");
            printf("        |      ANS|        \n");
            printf("        |         |        \n");
            printf("        |         |        \n");
            printf("   /|   |_________|        \n");
            printf("   ||                      \n");
        }
        if (frame == 12){
            printf("         _________    ||   \n");
            printf("        |   THE   |   ||   \n");
            printf("        |  CL     |   |/   \n");
            printf("        |         |        \n");
            printf("        |    DIANS|        \n");
            printf("        |         |        \n");
            printf("   /|   |         |        \n");
            printf("   ||   |_________|        \n");
            printf("   ||                      \n");
        }
        if (frame == 13){
            printf("         _________    ||   \n");
            printf("        |   THE   |   ||   \n");
            printf("        |  CLAS   |   ||   \n");
            printf("        |         |   |/   \n");
            printf("        |  ARDIANS|        \n");
            printf("   /|   |         |        \n");
            printf("   ||   |         |        \n");
            printf("   ||   |_________|        \n");
            printf("   ||                      \n");
        }
        if (frame == 14){
            printf("         _________    ||   \n");
            printf("        |   THE   |   ||   \n");
            printf("        |  CLASH  |   ||   \n");
            printf("        |         |   ||   \n");
            printf("   /|   |GUARDIANS|   |/   \n");
            printf("   ||   |         |        \n");
            printf("   ||   |         |        \n");
            printf("   ||   |_________|        \n");
            printf("   ||                      \n");
        }
        if (frame == 15){
            printf("         _________    ||   \n");
            printf("        |   THE   |   ||   \n");
            printf("        |  CLASH  |   ||   \n");
            printf("   /|   | O    HE |   ||   \n");
            printf("   ||   |GUARDIANS|   ||   \n");
            printf("   ||   |         |   |/   \n");
            printf("   ||   |         |        \n");
            printf("   ||   |_________|        \n");
            printf("   ||                      \n");
        }
        if (frame == 16){
            printf("         _________  __||__ \n");
            printf("        |   THE   |   ||   \n");
            printf("   /|   |  CLASH  |   ||   \n");
            printf("   ||   | OF  THE |   ||   \n");
            printf("   ||   |GUARDIANS|   ||   \n");
            printf("   ||   |         |   ||   \n");
            printf("   ||   |         |   |/   \n");
            printf(" __||__ |_________|        \n");
            printf("   ||                      \n");
        }
        if (frame == 17){
            printf("         _________    ||   \n");
            printf("   /|   |   THE   | __||__ \n");
            printf("   ||   |  CLASH  |   ||   \n");
            printf("   ||   | OF  THE |   ||   \n");
            printf("   ||   |GUARDIANS|   ||   \n");
            printf("   ||   |         |   ||   \n");
            printf(" __||__ |         |   ||   \n");
            printf("   ||   |_________|   |/   \n");
            printf("   ||                      \n");
        }
        if (frame == 18){
            printf("   /|    _________    ||   \n");
            printf("   ||   |   THE   |   ||   \n");
            printf("   ||   |  CLASH  | __||__ \n");
            printf("   ||   | OF  THE |   ||   \n");
            printf("   ||   |GUARDIANS|   ||   \n");
            printf(" __||__ |         |   ||   \n");
            printf("   ||   |         |   ||   \n");
            printf("   ||   |_________|   ||   \n");
            printf("   ||                 |/   \n");
        }
        if (frame == 19){
            printf("   /|    _________    ||   \n");
            printf("   ||   |   THE   |   ||   \n");
            printf("   ||   |  CLASH  | __||__ \n");
            printf("   ||   | OF  THE |   ||   \n");
            printf("   ||   |GUARDIANS|   ||   \n");
            printf(" __||__ |         |   ||   \n");
            printf("   ||   |         |   ||   \n");
            printf("   ||   |_________|   ||   \n");
            printf("   ||                 |/   \n");
        }
        if (frame == 20){
            printf("   /|    _________    ||   \n");
            printf("   ||   |   THE   |   ||   \n");
            printf("   ||   |  CLASH  | __||__ \n");
            printf("   ||   | OF  THE |   ||   \n");
            printf("   ||   |GUARDIANS|   ||   \n");
            printf(" __||__ |         |   ||   \n");
            printf("   ||   |         |   ||   \n");
            printf("   ||   |_________|   ||   \n");
            printf("   ||                 |/   \n");
        }
        if (frame == 21){
            printf("   /|    _________    |\n");
            printf("   ||   |   THE   |   |\n");
            printf("   ||   |  CLASH  | __|\n");
            printf("   ||   | OF  THE |   |\n");
            printf("   ||   |GUARDIANS|   |\n");
            printf(" __||__ |         |   |\n");
            printf("   ||   |         |   |\n");
            printf("   ||   |_________|   |\n");
            printf("   ||                 |\n");
        }
        if (frame == 22){
            printf("   /|    _________  \n");
            printf("   ||   |   THE   | \n");
            printf("   ||   |  CLASH  | \n");
            printf("   ||   | OF  THE | \n");
            printf("   ||   |GUARDIANS| \n");
            printf(" __||__ |         | \n");
            printf("   ||   |         | \n");
            printf("   ||   |_________| \n");
            printf("   ||               \n");
        }
        if (frame == 23){
            printf("   /|    _________\n");
            printf("   ||   |   THE   \n");
            printf("   ||   |  CLASH  \n");
            printf("   ||   | OF  THE \n");
            printf("   ||   |GUARDIANS\n");
            printf(" __||__ |         \n");
            printf("   ||   |         \n");
            printf("   ||   |_________\n");
            printf("   ||             \n");
        }
        if (frame == 24){
            printf("   /|    _______\n");
            printf("   ||   |   THE \n");
            printf("   ||   |  CLASH\n");
            printf("   ||   | OF  TH\n");
            printf("   ||   |GUARDIA\n");
            printf(" __||__ |       \n");
            printf("   ||   |       \n");
            printf("   ||   |_______\n");
            printf("   ||           \n");
        }
        if (frame == 25){
            printf("   /|    _____\n");
            printf("   ||   |   TH\n");
            printf("   ||   |  CLA\n");
            printf("   ||   | OF  \n");
            printf("   ||   |GUARD\n");
            printf(" __||__ |     \n");
            printf("   ||   |     \n");
            printf("   ||   |_____\n");
            printf("   ||         \n");
        }
        if (frame == 26){
            printf("   /|    ___\n");
            printf("   ||   |   \n");
            printf("   ||   |  C\n");
            printf("   ||   | OF\n");
            printf("   ||   |GUA\n");
            printf(" __||__ |   \n");
            printf("   ||   |   \n");
            printf("   ||   |___\n");
            printf("   ||       \n");
        }
        if (frame == 27){
            printf("   /|    _\n");
            printf("   ||   | \n");
            printf("   ||   | \n");
            printf("   ||   | \n");
            printf("   ||   |G\n");
            printf(" __||__ | \n");
            printf("   ||   | \n");
            printf("   ||   |_\n");
            printf("   ||     \n");
        }
        if (frame == 28){
            printf("   /|   \n");
            printf("   ||   \n");
            printf("   ||   \n");
            printf("   ||   \n");
            printf("   ||   \n");
            printf(" __||__ \n");
            printf("   ||   \n");
            printf("   ||   \n");
            printf("   ||   \n");
        }
        if (frame == 29){
            printf("   /| \n");
            printf("   || \n");
            printf("   || \n");
            printf("   || \n");
            printf("   || \n");
            printf(" __||_\n");
            printf("   || \n");
            printf("   || \n");
            printf("   || \n");
        }
        if (frame == 30){
            printf("   /\n");
            printf("   |\n");
            printf("   |\n");
            printf("   |\n");
            printf("   |\n");
            printf(" __|\n");
            printf("   |\n");
            printf("   |\n");
            printf("   |\n");
        }
        if (frame == 31){
            printf("  \n");
            printf("  \n");
            printf("  \n");
            printf("  \n");
            printf("  \n");
            printf(" _\n");
            printf("  \n");
            printf("  \n");
            printf("  \n");
        }
        usleep(200000);
    }
}

typedef struct{
    char cName[70];
    char cType[15];
    int LP;
    int AP;
    int DF;

    int OnTable;
    int inPlayer;
    int isDead;

} Card;

typedef struct{
    char pName[20];
    int pLives;
} Player;

int CountCards(int x){

    int y;
    FILE* fl = fopen("cards.txt", "r");

	if (fl == NULL){
        system("cls");
        printf("No card text file found");
        sleep(2);
	}    

    int curLine = 1;
    char c;

    do{     
        c = fgetc(fl);
        if (c == '\n'){
            curLine++;
        }
    } while(c != EOF);
    fclose(fl);

    y = curLine;

    if (y < 30){
        system("cls");
        printf("File doesn't have enough cards :c");
        sleep(2);
    }
   
    return y;
}

int TutorialFunc(){

    system("cls");
    printf("First things first. You are always given a deck of 15 cards, each one has a name and type but that doesnt matter");
    printf("\nWhat matters are the stat points.");
    printf("\nLP being the LIFE POINTS that the card gets");
    printf("\nAP being the ABILITY POWER or damage");
    printf("\nDF being the DEFENCE which reduces damage received");
    sleep(10);
    printf("\n\nFrom the deck of 15 cards, you have to choose 3 which will be placed on the battle at the start of the game");
    printf("\nEach player has 5 lives, and to win you need to kill the opponent's cards 5 times. Only cards on table can attack or be attacked.");
    printf("\nOnce placed, you cant take those cards in deck again.\n");
    system("pause");
    return 0;
}

void GamePrep(){

    int gameRun = 1;
    int countToVoid;
    int count;
    int records = 0;

    int numberOfCards = CountCards(count);

    if(numberOfCards < 30){
        return 1;

    }

    printf("\ncount card of: %d",numberOfCards);
    Card cards[numberOfCards];

    //Here it reads the cards and places them on a struct

    FILE* file = fopen("cards.txt", "r");

	if (file == NULL){
        system("cls");
        printf("No card text file found");
        sleep(2);
	}    
    
    else{  
        //From here cards are made and a system to check if the file format is correct
       
        int read = 0;
    
        do{
            read = fscanf(file,"%69[^,],%14[^,],%d,%d,%d\n",
                                cards[records].cName,
                                cards[records].cType,
                                &cards[records].LP,
                                &cards[records].AP,
                                &cards[records].DF);

            if (read == 5) {
                records++;
            }
            
            if (read != 5 && !feof(file)){
                printf("Incorrect text file format");
                sleep(5);
                return 1;
            }
            if (ferror(file)){
                system("cls");
                printf("Error reading file");
                sleep(2);
                return 1;
            } 

        } while(!feof(file));

        close(file);
        
    }

    //cards put at random

    srand(time(0));
    int posit;
    int cardAux;
    int cardReplace;

    Card positCard[1];

    for(posit = 0; posit < numberOfCards; posit++){

        cardReplace = (rand() % numberOfCards); //makes a random position to swap list content

        //places current position to an auxiliary list where the data is stored and saved
        strcpy(positCard[0].cName, cards[posit].cName);
        strcpy(positCard[0].cType,cards[posit].cType);
        positCard[0].LP = cards[posit].LP;
        positCard[0].AP = cards[posit].AP;
        positCard[0].DF = cards[posit].DF;

        //places swaps random position content with the current position 
        strcpy(cards[posit].cName, cards[cardReplace].cName);
        strcpy(cards[posit].cType, cards[cardReplace].cType);
        cards[posit].LP = cards[cardReplace].LP;
        cards[posit].AP = cards[cardReplace].AP;
        cards[posit].DF = cards[cardReplace].DF;

        //places the saved content into the replacement position
        strcpy(cards[cardReplace].cName, positCard[0].cName);
        strcpy(cards[cardReplace].cType, positCard[0].cType);
        cards[cardReplace].LP = positCard[0].LP;
        cards[cardReplace].AP = positCard[0].AP;
        cards[cardReplace].DF = positCard[0].DF;
    }

    system("cls");
    printf("\n%d Cards counted.", numberOfCards);
    printf("\nFile is correct, Cards shuffled.");
    printf("\nGame is ready to be played");
    sleep(3);
    system("cls");

    int count1 = 0;
    int count2 = 0;

    for(int l = 0; l < numberOfCards; l++){ //Giving cards to players

        system("cls");
        cards[l].OnTable = 0;
        cards[l].inPlayer = 0;

        if (l < 15){
            cards[l].inPlayer = 1;
            cards[l].isDead = 0;
        }
        if (l > 14 && l < 30){
            cards[l].inPlayer = 2;
            cards[l].isDead = 0;
        }

        if (cards[l].inPlayer == 1){
            count1++;
            
        }
        if (cards[l].inPlayer == 2){
            count2++;
        }

        printf("\n%d cards to player 1.",count1);
        printf("\n%d cards to player 2.",count2);
        
        usleep(20000);
        
    }

    //game starts

    int Tutorial = 1;
    int TutorialInput;

    do{ //Game
        system("cls");

        do{ //Tutorial

            system("cls");
            printf("Enter 1 if you want a tutorial:");
            scanf(" %d",&TutorialInput);
            if(TutorialInput == 1){
                TutorialFunc();
                Tutorial++;
            }
            if(TutorialInput != 1){
                Tutorial++;
            }
        }while(Tutorial == 1);

        GAMEON( cards, numberOfCards);
        gameRun = 0;

    }while(gameRun == 1);
}

void GAMEON(Card cards[], int numberOfCards){  //Battle starts

    int starterCardCheck = 1;
    int cardOrder;
    int PlayerCard = 1;
    int confirmS = 1;
    
    int S1, S2, S3;

    do{
        system("cls");
        printf("Choose 3 cards to start this fight\n");

        for(cardOrder = 0; cards[cardOrder].inPlayer == 1; cardOrder++){
            printf("\n\nCard number %d: %s %s ( LP: %d | AP: %d | DF: %d)",
            cardOrder, 
            cards[cardOrder].cName, 
            cards[cardOrder].cType, 
            cards[cardOrder].LP, 
            cards[cardOrder].AP,
            cards[cardOrder].DF);
        }

        do{
            printf("\n\nType your 3 selections based on the number of the card: ");

            
            scanf("%d %d %d", &S1, &S2, &S3); 

            if (S1 != S2 && S2 != S3 && S3 != S1){
                if(-1 < S1 && -1 < S2  && -1 < S3 ){
                    if(S1 < 15 && S2 < 15 && S3 < 15){
                        system("cls");
                        printf("\n\nChoices are different and compatible");
                        printf("\nChosen cards are: \n%s\n%s\n%s", cards[S1].cName, cards[S2].cName, cards[S3].cName);
                        confirmS = 0;
                        printf("\n\n");
                        cards[S1].OnTable = 1;
                        cards[S2].OnTable = 1;
                        cards[S3].OnTable = 1;
                    }
                    else{
                        printf("Choices are different but they are not compatible with the deck");       
                    }
                }
                else{
                    printf("Choices are different but they are not compatible with the deck");
                }
            } 
            else{
                printf("Choices are equal, please choose different options");
            }

            system("\npause");

        }while(confirmS == 1);


        starterCardCheck = 0;

    }while (starterCardCheck == 1);

    cards[15].OnTable = 1;
    cards[16].OnTable = 1;
    cards[17].OnTable = 1;

    int Turn = 1;
    int TurnTime = 0;
    int gameEnd = 0; 

    Player player[3];
    system("cls");
    printf("Choose your name (Please no spaces): ");
    scanf("%s", &player[1].pName);

    player[1].pLives = 5;
    player[2].pLives = 5;

    FILE *addHistory = fopen("history.txt","w");
    fflush(addHistory);

    fprintf(addHistory,"GAME HISTORY");

    if(addHistory == NULL){
        system("cls");
        printf("There was an error opening the file\n");
        system("pause");
        return 0;
    }    

    fprintf(addHistory,"\n%s joins the battle",player[1].pName);
    fprintf(addHistory,"\n%s\n%s\n%s",cards[S1].cName, cards[S2].cName, cards[S3].cName);
    fprintf(addHistory,"\nThese cards were chosen by %s to start the battle with",player[1].pName);
    fprintf(addHistory,"\n\n%s\n%s\n%s",cards[15].cName, cards[16].cName, cards[17].cName);
    fprintf(addHistory,"\nThese cards were chosen by the BOT to start the battle with");
    fprintf(addHistory,"\n\n%s has the first turn",player[1].pName); 

    do{
        system("cls");
        printf("Lives\n%s : %d\nRival : %d", player[1].pName, player[1].pLives, player[2].pLives);
        printf("\n\n\nYour cards\n");
        for(int PlayerCards = 0; PlayerCards < 15 ; PlayerCards++){        //shows player's cards

            if(cards[PlayerCards].OnTable == 1){
                printf("\n\nCard number :%d\n%s  LP: %d | AP: %d | DF: %d", 
                                PlayerCards,
                                cards[PlayerCards].cName, 
                                cards[PlayerCards].LP,
                                cards[PlayerCards].AP,
                                cards[PlayerCards].DF);
            }
        }

        printf("\n\n\nEnemy's cards:");

        for(int PlayerCards = 15; PlayerCards < 30 ; PlayerCards++){           //shows cards of the enemy

            if(cards[PlayerCards].OnTable == 1){
                printf("\n\nCard number: %d\n%s  LP: %d | AP: %d | DF: %d",
                                PlayerCards,
                                cards[PlayerCards].cName, 
                                cards[PlayerCards].LP,
                                cards[PlayerCards].AP,
                                cards[PlayerCards].DF);
            }
        }
        printf("\n\n");
        printf(" _____||____________________________ \n");
        printf(" _____||____________________________ \n");
        printf("      ||                            ");
        printf("\n\n\n");

        do{ //if Turn is 1, then it is the player's turn to act
            int Action;
            int confAction = 1;
            printf("It's your turn to play!\n");
            printf("Choose your move.");
            printf("\n\nAttack : 1\nPlace card : 2\nSee cards in deck : 3\nEnd game : 4\n\n");

            do{
                printf("Choice: ");
                scanf("%d",&Action);

                if (Action < 0 || Action > 5){            //here we check if the user input is correct and can be used
                    printf(" <-- Wrong Input\n");
                    continue;
                }

                if (Action == 1){
                    int Act1Conf = 0;
                    for (int checkInTable = 0; checkInTable < 15; checkInTable++){   //here we make a count in case the ACTION 1 cant be performed 
                        if (cards[checkInTable].OnTable == 1){
                            Act1Conf++;
                            break;
                        }
                    }

                    if (Act1Conf == 0){                          //if there are no cards on table it will make the user select other option
                        printf("\nYou have no cards on battle\n");
                        sleep(3);
                        break;
                    }
                    
                    if (Act1Conf > 0){     //if there are cards in battle, then action 1 continues to run
                        int useCard = -1;
                        int targetCard = -1;
                        do{
                            printf("Choose the card to attack with: ");
                            scanf("%d",&useCard);

                            if(cards[useCard].isDead == 0 && cards[useCard].OnTable == 1 && cards[useCard].inPlayer == 1){
                                break;
                            }
                            printf("<--- Incorrect Pick\n");
                            useCard = -1;
                        }while(useCard == -1);

                        printf("\n\n");

                        do{
                            printf("Choose the card to attack: ");
                            scanf("%d",&targetCard);

                            if(cards[targetCard].isDead == 0 && cards[targetCard].OnTable == 1 && cards[targetCard].inPlayer == 2){
                                break;
                            }
                            printf("<--- Incorrect Pick\n");
                            targetCard = -1;
                        }while(targetCard == -1);

                        int TotalDamage;

                        TotalDamage = cards[useCard].AP - cards[targetCard].DF;

                        if(TotalDamage < 0){
                            TotalDamage = 0;
                        }

                        cards[targetCard].LP = cards[targetCard].LP - TotalDamage;

                        if ( cards[targetCard].LP <= 0 ){
                            
                            player[2].pLives--;
                            cards[targetCard].isDead = 1;
                            cards[targetCard].OnTable = 0;
                            fprintf(addHistory,"\n\n%s was KILLED by %s\nBy dealing %d points of damage\n\n", 
                                                                        cards[targetCard].cName, 
                                                                        cards[useCard].cName,
                                                                        TotalDamage);

                            printf("\n\n%s was KILLED by %s\nBy dealing %d points of damage\n\n", 
                                                                        cards[targetCard].cName, 
                                                                        cards[useCard].cName,
                                                                        TotalDamage);

                        }
                        else if(TotalDamage <= 0){
                            fprintf(addHistory,"\n\n%s Tanked all the damage from %s\nMaking them deal %d points of damage because of the DF\n\n", 
                                                                        cards[targetCard].cName, 
                                                                        cards[useCard].cName,
                                                                        TotalDamage);
                            printf("\n\n%s Tanked all the damage from %s\nMaking them deal %d points of damage because of the DF\n\n", 
                                                                        cards[targetCard].cName, 
                                                                        cards[useCard].cName,
                                                                        TotalDamage);
                        }
                        else if(cards[targetCard].LP > 0){
                            fprintf(addHistory,"\n\n%s was DAMAGED by %s\nBy dealing %d points of damage\n\n", 
                                                                        cards[targetCard].cName, 
                                                                        cards[useCard].cName,
                                                                        TotalDamage);
                            printf("\n\n%s was DAMAGED by %s\nBy dealing %d points of damage\n\n", 
                                                                        cards[targetCard].cName, 
                                                                        cards[useCard].cName,
                                                                        TotalDamage);
                        }
                        
                        confAction = 0;
                        Turn=2;
                        printf("\n\n");
                        system("pause");
                        
                    }  //end confirm action 1
                }   //action 1 end

                if (Action == 2){
                    int availableInDeck = 0;
                    for (int CheckInDeck = 0; CheckInDeck < 15; CheckInDeck++){
                        if ( cards[CheckInDeck].isDead == 0 && cards[CheckInDeck].OnTable == 0){
                            availableInDeck++;
                            break;
                        }
                    }

                    if (availableInDeck == 0){
                        printf("\n\nYou have no cards left in deck\n");
                        
                        system("pause");
                        break;
                    }

                    int putCard = -1;

                    system("cls");

                    for (int put = 0; put < 15 ; put++){

                        if (cards[put].OnTable == 0 && cards[put].isDead == 0){
                            printf("\n\nCard number :%d\n%s  LP: %d | AP: %d | DF: %d", 
                                put,
                                cards[put].cName, 
                                cards[put].LP,
                                cards[put].AP,
                                cards[put].DF);
                        }
                    }

                    printf("\n\nChoose a card to place in battle: ");
                    
                    do{
                        putCard = -1;
                        scanf("%d",&putCard);
                        if(cards[putCard].OnTable == 0 && cards[putCard].isDead == 0 && cards[putCard].inPlayer == 1){
                            break;
                        }
                        printf(" <--- This card is either dead or doesnt exist in your deck\nChoose a card to place in battle: ");

                        putCard = -1;
                    }while(putCard == -1);
                    fprintf(addHistory,"\n\n%s was placed on battle\n",cards[putCard].cName);
                    cards[putCard].OnTable = 1;
                    confAction = 0;
                    Turn=2;

                } //end Action 2
                
                if (Action == 3){
                    int Act3conf = 0;

                    for(int showYourCards = 0; showYourCards < 15; showYourCards++){
                        if(cards[showYourCards].isDead == 0 && cards[showYourCards].OnTable == 0){
                            printf("\n\nCard number :%d\n%s  LP: %d | AP: %d | DF: %d", 
                                showYourCards,
                                cards[showYourCards].cName, 
                                cards[showYourCards].LP,
                                cards[showYourCards].AP,
                                cards[showYourCards].DF); 
                            Act3conf++;
                        }
                        
                    }
                    printf("\n\n");
                    system("pause");

                    if(Act3conf == 0){
                        printf("\n\nThere are no cards left in the deck\n");
                        system("pause");
                        Turn = 1;
                        break;
                    }

                    confAction = 0;
                    Turn=1;
                }          //End action 3

                if (Action == 4){

                    printf("\n\n Are you sure you want to end the game here?\n Yes : 1\n No : 0");

                    int ans = -1;
                    do{
                        printf("\nAnswer: ");
                        scanf(" %d",&ans);
                        
                        if(ans == 1){
                            fprintf(addHistory,"\n\nGame ended by %s's choice",player[1].pName);
                            fclose(addHistory);
                            return 1;
                        }
                        if(ans == 0){
                            break;
                        }
                        

                    }while(ans == -1);

                    confAction = 0;
                    Turn=1;

                }       //end Action 4

            }while(confAction == 1);   //this is to end confirmation of the action 

        }while(Turn == 1);    //end of turn 1 (player's turn)

        if(player[2].pLives < 1){
            printf("VICTORY\n\nYou won the game with %d lives left",player[1].pLives);
            sleep(5);
            
            fprintf(addHistory,"\n\n%s WON THE BATTLE!",player[1].pName);
            fclose(addHistory);
            break;

        }

        do{ //if Turn is 2, then it is the bot's turn to act

            int CountBotCards = 0;

            for(int count = 15; count < 30; count++){
                if (cards[count].OnTable == 1 && cards[count].inPlayer == 2){
                    CountBotCards++;
                }      
            }
            srand(time(0));

            
                int randomAction;
                randomAction = (rand()% 20);

                int countAvailableDeck = 0;
                int countAvailableTable = 0;
                
                for (int checkInDeck = 15;checkInDeck < 30;checkInDeck++){
                    if (cards[checkInDeck].OnTable == 0 && cards[checkInDeck].isDead == 0){
                        countAvailableDeck++;
                    }

                    if (cards[checkInDeck].OnTable == 1){
                        countAvailableTable++;
                    }
                }

                int highestAP = 15;
                int lowestLP = 500;

                if (countAvailableTable > 0){ //attack
                    for (int checkAP = 15; checkAP < 30; checkAP++){
                        if (cards[checkAP].OnTable == 1 && cards[checkAP].AP > cards[highestAP].AP){
                            highestAP = checkAP;
                        }
                    }
                    
                    for (int checkLP = 0; checkLP < 15; checkLP++){
                        if (cards[checkLP].OnTable == 1 && cards[checkLP].LP < cards[lowestLP].LP){
                            lowestLP = checkLP;
                        }
                    }

                    int totalDamage;

                    totalDamage = cards[highestAP].AP - cards[lowestLP].DF;

                    if (totalDamage < 0){
                        totalDamage = 0;
                    }

                    cards[lowestLP].LP = cards[lowestLP].LP - totalDamage;

                    if ( cards[lowestLP].LP <= 0 ){

                        player[1].pLives--;
                        cards[lowestLP].isDead = 1;
                        cards[lowestLP].OnTable = 0;
                        fprintf(addHistory,"\n\n%s was KILLED by %s\nBy dealing %d points of damage\n\n", 
                                                                    cards[lowestLP].cName, 
                                                                    cards[highestAP].cName,
                                                                    totalDamage);

                        printf("\n\n%s was KILLED by %s\nBy dealing %d points of damage\n\n", 
                                                                    cards[lowestLP].cName, 
                                                                    cards[highestAP].cName,
                                                                    totalDamage);

                    }
                    else if(totalDamage <= 0){
                        fprintf(addHistory,"\n\n%s Tanked all the damage from %s\nMaking them deal %d points of damage because of the DF\n\n", 
                                                                    cards[lowestLP].cName, 
                                                                    cards[highestAP].cName,
                                                                    totalDamage);

                        printf("\n\n%s Tanked all the damage from %s\nMaking them deal %d points of damage because of the DF\n\n", 
                                                                    cards[lowestLP].cName, 
                                                                    cards[highestAP].cName,
                                                                    totalDamage);
                    }
                    else if(cards[lowestLP].LP > 0){
                        fprintf(addHistory,"\n\n%s was DAMAGED by %s\nBy dealing %d points of damage\n\n", 
                                                                    cards[lowestLP].cName, 
                                                                    cards[highestAP].cName,
                                                                    totalDamage);

                        printf("\n\n%s was DAMAGED by %s\nBy dealing %d points of damage\n\n", 
                                                                    cards[lowestLP].cName, 
                                                                    cards[highestAP].cName,
                                                                    totalDamage);
                    }
                    
                    printf("\n\n");
                    system("pause");    
                }

                else{       //place card
                    
                    srand(time(0));

                    int randPick;
                    int randPickConf = 1;

                    do{
                        randPick = (rand()% 15) + 15;

                        if ( cards[randPick].OnTable == 0 && cards[randPick].isDead == 0){
                            break;
                        }
                    } while(randPickConf == 1);
                    
                    cards[randPick].OnTable = 1;
                    fprintf(addHistory,"\n\nThe Opponent placed %s on the battle.", cards[randPick].cName);
                    printf("\n\nThe Opponent placed %s on the battle.", cards[randPick].cName);
                    
                    printf("\n\n");
                    system("pause"); 
                    Turn = 1; 
                }
            
            Turn = 1;
        }while ( Turn == 2);          //end Turn 2

        if(player[1].pLives < 1){
            printf("DEFEAT\n\nYour rival won the game with %d lives left",player[2].pLives);
            sleep(5);
            fprintf(addHistory,"\n\nBOT WON THE BATTLE!");
            fclose(addHistory);
            break;
        }
        printf("\n\n");
        system("pause");
    }while (gameEnd == 0);
    
    system("cls");
    printf("Do you wish to see the history of your recent game");

}

void AddCard(){

    int check = 1;
    char checkName[70];
    char checkType[15];
    int checkLP = 1;
    int checkAP = 1;
    int checkDF = 1;
    
    do{
        system("cls");
        int answer;
        printf("Write your card in the following format\nName,Type,LP,AP,DF\n");
   
        scanf("%69[^,],%14[^,],%d,%d,%d", &checkName, &checkType, &checkLP, &checkAP, &checkDF);

        if(checkLP > 100 || checkAP > 100 || checkDF > 100){
            printf("\n\nSome of the starts are too high");
        }
        
        printf("\nAre you sure you want\n%s,%s | %d | %d | %d\n to be your new card? \nYes: 1\nTry again: 0 \nAnswer: ",checkName, checkType, checkLP, checkAP, checkDF);

        scanf("%d",&answer);

        if (answer == 1){
            break;
        }
        else{
            continue;
        }

    } while (check == 1);

    FILE *writeTo = fopen("cards.txt", "a");
    
    if (writeTo == NULL){
        system("cls");
        printf("No cards file found");
        sleep(2);
        return 1;
	}    

    fprintf(writeTo, "\n%s,%s,%d,%d,%d",checkName, checkType, checkLP, checkAP, checkDF);
    
    fclose(writeTo);
    system("cls");
    printf("Your card has been added successfuly");
    sleep(5);
    return 1;
}

void SeeHistory(){
    system("cls");
    printf("Game History");

    FILE *rh = fopen("history.txt","r");

    if(rh == NULL){
        
        printf("\n\nError reading file");
        return 1;
    }
    char line[200];
    while(!feof(rh)){
        fgets(line,200,rh);
        puts(line);

    }

    printf("\n\n");
    system("pause");
    return 1;
}

int main(){

    int Intro = 1;
    int gameMenu = 1;
    int menuSelector = 1;
    int menuInput;

    if (Intro == 1){

        IntroSecuence();

        Intro = 0;
    }

    while (gameMenu > 0){
        
        system("cls");
        menuSelector = 1;

        while (menuSelector == 1){
            
            system("cls");

            menuInput = 0;
            
            printf("        Menu\n\nTo play input 1\nTo add cards input 2\nTo see your recent game history input 3\nTo close game input 4\nInput:");
            
            
            menuInput = getche();
            menuInput = menuInput -48; 

            if(menuInput > 0 && menuInput < 5){
                menuSelector = 0;
            }
            else{
                printf("\nPlease use the correct input (1,2,3,4)");
                sleep(3);
            }
            
        }

        switch (menuInput){

            case 1:
                GamePrep();
                break;
            
            case 2:
                AddCard();
                break;

            case 3:
                SeeHistory();
                break;
            case 4:
                gameMenu = 0;
                system("cls");
                break;
        }
    }
    return 0;
}